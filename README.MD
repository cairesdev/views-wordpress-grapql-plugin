# ğŸ“Š GraphQL and Post Views

**VersÃ£o:** 1.2  
**Autor:** [cairesdev]  
**DescriÃ§Ã£o:**  
Este plugin adiciona suporte para rastreamento de visualizaÃ§Ãµes de posts em WordPress. As visualizaÃ§Ãµes sÃ£o atualizadas via REST API e podem ser consultadas pela API GraphQL.

---

## ğŸ”§ Funcionalidades

### 1. Consulta de VisualizaÃ§Ãµes via GraphQL

Adiciona o campo `views` ao tipo `Post` na API GraphQL.

- **Campo:** `views`  
- **Tipo:** `Int`  
- **DescriÃ§Ã£o:** NÃºmero de visualizaÃ§Ãµes do post

#### Exemplo de query:
```graphql
query {
  post(id: "meu-post", idType: SLUG) {
    title
    views
  }
}
````

---

### 2. Incremento de VisualizaÃ§Ãµes via REST API

Exponibiliza uma rota REST para incrementar as visualizaÃ§Ãµes de um post.

#### Endpoint:

```
POST /wp-json/views/v1/hit/{slug}
```

* **ParÃ¢metro da URL:**
  `slug` â€“ Slug do post (ex: `meu-post`)

* **Resposta de Sucesso (`200 OK`):**

```json
{
  "postId": 123,
  "slug": "meu-post",
  "views": 42
}
```

* **Erros PossÃ­veis:**

  * `400 Bad Request` â€“ Post invÃ¡lido ou nÃ£o publicado.

---

## ğŸ› ï¸ Como Funciona

* Usa `graphql_register_types` para adicionar o campo `views` ao tipo `Post`.
* Usa `register_rest_route` para criar a rota REST `/views/v1/hit/{slug}`.
* A cada requisiÃ§Ã£o POST, incrementa o campo `views` no meta do post.

---

## âœ… PermissÃµes

* A rota REST estÃ¡ acessÃ­vel publicamente (`__return_true`), sem necessidade de autenticaÃ§Ã£o.

> âš ï¸ **AtenÃ§Ã£o:** Considere proteger a rota se quiser evitar manipulaÃ§Ã£o ou spam de visualizaÃ§Ãµes.

---

## ğŸ“Œ Requisitos

* WordPress com [WPGraphQL](https://www.wpgraphql.com/) instalado e ativo.
* Permalinks ativados para uso correto dos slugs.

---

## ğŸ’¡ Dicas de IntegraÃ§Ã£o

* FaÃ§a uma chamada `POST` ao endpoint REST ao carregar uma pÃ¡gina de post via JavaScript.
* Exemplo usando `fetch` no frontend:

```js
fetch('/wp-json/views/v1/hit/meu-post', {
  method: 'POST'
});
```

* Em temas com cache agressivo, certifique-se de que a chamada seja feita do lado do cliente para registrar corretamente as visualizaÃ§Ãµes.

---

## ğŸ“ƒ LicenÃ§a

Este plugin estÃ¡ licenciado sob a [MIT License](https://opensource.org/licenses/MIT).
