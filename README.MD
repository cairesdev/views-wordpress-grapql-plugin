# üìä GraphQL and Post Views

**Vers√£o:** 1.2  
**Autor:** [cairesdev]  
**Descri√ß√£o:**  
Este plugin adiciona suporte para rastreamento de visualiza√ß√µes de posts em WordPress. As visualiza√ß√µes s√£o atualizadas via REST API e podem ser consultadas pela API GraphQL.

---

## üîß Funcionalidades

### 1. Consulta de Visualiza√ß√µes via GraphQL

Adiciona o campo `views` ao tipo `Post` na API GraphQL.

- **Campo:** `views`  
- **Tipo:** `Int`  
- **Descri√ß√£o:** N√∫mero de visualiza√ß√µes do post

#### Exemplo de query:
```graphql
query {
  post(id: "meu-post", idType: SLUG) {
    title
    views
  }
}
````

---

### 2. Incremento de Visualiza√ß√µes via REST API

Exponibiliza uma rota REST para incrementar as visualiza√ß√µes de um post.

#### Endpoint:

```
POST /wp-json/views/v1/hit/{slug}
```

* **Par√¢metro da URL:**
  `slug` ‚Äì Slug do post (ex: `meu-post`)

* **Resposta de Sucesso (`200 OK`):**

```json
{
  "postId": 123,
  "slug": "meu-post",
  "views": 42
}
```

* **Erros Poss√≠veis:**

  * `400 Bad Request` ‚Äì Post inv√°lido ou n√£o publicado.

---

## üõ†Ô∏è Como Funciona

* Usa `graphql_register_types` para adicionar o campo `views` ao tipo `Post`.
* Usa `register_rest_route` para criar a rota REST `/views/v1/hit/{slug}`.
* A cada requisi√ß√£o POST, incrementa o campo `views` no meta do post.

---

## ‚úÖ Permiss√µes

* A rota REST est√° acess√≠vel publicamente (`__return_true`), sem necessidade de autentica√ß√£o.

> ‚ö†Ô∏è **Aten√ß√£o:** Considere proteger a rota se quiser evitar manipula√ß√£o ou spam de visualiza√ß√µes.

---

## üìå Requisitos

* WordPress com [WPGraphQL](https://www.wpgraphql.com/) instalado e ativo.
* Permalinks ativados para uso correto dos slugs.

---

## üí° Dicas de Integra√ß√£o

* Fa√ßa uma chamada `POST` ao endpoint REST ao carregar uma p√°gina de post via JavaScript.
* Exemplo usando `fetch` no frontend:

```js
fetch('/wp-json/views/v1/hit/meu-post', {
  method: 'POST'
});
```

* Em temas com cache agressivo, certifique-se de que a chamada seja feita do lado do cliente para registrar corretamente as visualiza√ß√µes.
